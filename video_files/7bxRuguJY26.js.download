;/*FB_PKG_DELIM*/

__d("WAWebCRUDOperationsMediaPlaybackEvent",["WAWebSchemaMediaPlaybackEvent","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WAWebSchemaMediaPlaybackEvent").getMediaPlaybackEventTable().bulkCreateOrReplace(a.map(function(a){return{event:a}}))}function c(a){return d("WAWebSchemaMediaPlaybackEvent").getMediaPlaybackEventTable().all({limit:a,offset:0})}function e(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WAWebSchemaMediaPlaybackEvent").getMediaPlaybackEventTable().count()});return h.apply(this,arguments)}function f(a){return d("WAWebSchemaMediaPlaybackEvent").getMediaPlaybackEventTable().bulkRemove(a)}g.addEvents=a;g.getOldestEvents=c;g.getRowCount=e;g.deleteEvents=f}),98);
__d("WAWebMediaPlaybackEventLoggerCache",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=[]}var b=a.prototype;b.write=function(a){if(Array.isArray(a)){var b;(b=this.$1).push.apply(b,a);return}this.$1.push(a)};b.consume=function(){var a=this.$1;this.$1=[];return a};return a}();f.MediaPlaybackEventLoggerCache=a}),66);
__d("WAWebMediaPlaybackEventPersistentQueue",["WALogger","WAWebCRUDOperationsMediaPlaybackEvent","WAWebPromiseQueue","lodash"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MediaPlaybackEventPersistentQueue] write failed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MediaPlaybackEventPersistentQueue] write success"]);i=function(){return a};return a}var j=new(d("WAWebPromiseQueue").PromiseQueue)();a=200;b=c("lodash").throttle(function(a){return k(a)},a);function k(a){return j.enqueue(function(){var b=a.consume();if(b.length===0)return;return d("WAWebCRUDOperationsMediaPlaybackEvent").addEvents(b).then(function(){d("WALogger").DEV(i()).devConsole(b)})["catch"](function(c){d("WALogger").ERROR(h()).devConsole(c).sendLogs("media-playback-event-persistent-queue-write-failed"),a.write(b)})})}g.writePromiseQueue=j;g.WRITE_THROTTLE_INTERVAL=a;g.addToQueue=b}),98);
__d("WAWebSNAPLUploadMusicConsumptionLogs",["WALogger","WAWebACSTokenConfig","WAWebBuildConstants","WAWebFileUtils","WAWebMobilePlatforms","WAWebNetworkStatus","WAWebOHAIClient","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SNAPL] logs uploaded via OHAI"]);h=function(){return a};return a}var i=new URL("https://acs.whatsapp.com/music/reporting"),j=656096963291760..toString(),k=167028690535322..toString();function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield c("WAWebNetworkStatus").waitIfOffline();a=m(a);a=(yield d("WAWebOHAIClient").fetchOHAI({url:i,project:d("WAWebACSTokenConfig").ACS_PROJECTS.WA_StatusMusicReporting,payload:a}));d("WALogger").DEV(h()).devConsole(a);return a});return l.apply(this,arguments)}function m(a){var b=new FormData(),c=d("WAWebMobilePlatforms").isSMB()?j:k;b.append("app_id",c);b.append("app_version",d("WAWebBuildConstants").VERSION_STR);b.append("events",d("WAWebFileUtils").createFile([n(a)],"snapl.txt"));return b}function n(a){return a.map(function(a){return JSON.stringify(a)}).join("\n")}g.uploadMusicConsumptionLogs=a}),98);
__d("WAWebMediaPlaybackEventUploader",["WAExponentialBackoff","WALogger","WAWebABProps","WAWebCRUDOperationsMediaPlaybackEvent","WAWebNetworkStatus","WAWebPromiseQueue","WAWebSNAPLUploadMusicConsumptionLogs","asyncToGeneratorRuntime","err","lodash"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MediaPlaybackEventUploader] failed to upload events"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MediaPlaybackEventUploader.upload] success"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MediaPlaybackEventUploader.upload] attempt # ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MediaPlaybackEventUploader] starting upload"]);k=function(){return a};return a}var l=100;e=3e3;var m=new(d("WAWebPromiseQueue").PromiseQueue)(),n=c("lodash").throttle(a,e);function a(){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield m.enqueue(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebCRUDOperationsMediaPlaybackEvent").getRowCount());if(a===0)return{success:!0,leftover:0};var b=(yield s()),e=b.events;b=b.ids;var f=e.length;if(f===0)return{success:!0,leftover:0};try{e=(yield p(e));if(!e.ok)throw c("err")("upload failed")}catch(b){d("WALogger").ERROR(h()).devConsole(b);return{success:!1,leftover:a}}yield d("WAWebCRUDOperationsMediaPlaybackEvent").deleteEvents(b);return a>f?{success:!0,leftover:a-f}:{success:!0,leftover:0}}))),e=a.success;a=a.leftover;if(e&&a>0)return n()});return o.apply(this,arguments)}function p(a){d("WALogger").DEV(k()).devConsole(a);var e=new AbortController();e=e.signal;return d("WAExponentialBackoff").exponentialBackoff({retries:3,signal:e,minTimeout:1e3},function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,e){d("WALogger").DEV(j(),e+1);yield c("WAWebNetworkStatus").waitIfOffline();e=(yield d("WAWebSNAPLUploadMusicConsumptionLogs").uploadMusicConsumptionLogs(a));if(e==null)throw c("err")("upload failed");if(e.ok){d("WALogger").DEV(i());return e}if(q(e))return b(c("err")("upload failed with status code: "+e.status));throw c("err")("upload failed")});return function(a,b){return e.apply(this,arguments)}}())}function q(a){return a.status>=500}function r(){return Math.max(d("WAWebABProps").getABPropConfigValue("ohai_request_kb_size")-1,1)*1e3}function s(){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=0,b=(yield d("WAWebCRUDOperationsMediaPlaybackEvent").getOldestEvents(l)),c=new TextEncoder();return b.reduce(function(b,d){var e=c.encode(JSON.stringify(d.event)).length;if(a+e>r())return b;a+=e;b.events.push(d.event);b.ids.push(d.id);return b},{events:[],ids:[]})});return t.apply(this,arguments)}g.MAX_BATCH_SIZE=l;g.UPLOAD_THROTTLE_INTERVAL=e;g.uploadQueue=m;g.requestUpload=n}),98);
__d("WAWebMediaPlaybackEventLogger",["WALogger","WAWebMediaPlaybackEventLoggerCache","WAWebMediaPlaybackEventPersistentQueue","WAWebMediaPlaybackEventUploader"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MediaPlaybackEventLogger] Failed to flush logs"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MediaPlaybackEventLogger][","] log"]);i=function(){return a};return a}a=function(){function a(a){this.$1=a}var b=a.prototype;b.log=function(a){d("WALogger").DEV(i(),a.required_metadata.media_id).devConsole(a),this.$1.write(a),this.$2()};b.$2=function(){d("WAWebMediaPlaybackEventPersistentQueue").addToQueue(this.$1).then(d("WAWebMediaPlaybackEventUploader").requestUpload)["catch"](function(a){d("WALogger").ERROR(h()).devConsole(a).sendLogs("media-playback-event-logger-flush-failed")})};return a}();b=new a(new(d("WAWebMediaPlaybackEventLoggerCache").MediaPlaybackEventLoggerCache)());g.MediaPlaybackEventLoggerImpl=a;g.MediaPlaybackEventLogger=b}),98);
__d("WAWebPsChannelsSnaplEventWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({PsChannelsSnaplEvent:[6254,{appId:[2,d("WAWebWamCodegenUtils").TYPES.INTEGER],videoEventJson:[1,d("WAWebWamCodegenUtils").TYPES.STRING]},[1,1,1],"private",0]},{PsChannelsSnaplEvent:[]});g.PsChannelsSnaplEventWamEvent=a}),98);
__d("WAWebMediaPlaybackLogFlusher",["WALogger","WAWebMediaPlaybackEventLogger","WAWebPsChannelsSnaplEventWamEvent","WAWebVideoOrigin"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mediaplaybacklogflusher][","] Discarding events"]);h=function(){return a};return a}a=function(){function a(a,b){this.$1=a,this.$2=b}var b=a.prototype;b.flushLogs=function(){var a=this.$1.consumeLoggerEvents();switch(this.$2){case d("WAWebVideoOrigin").VideoOrigin.Newsletter:a.forEach(function(a){new(d("WAWebPsChannelsSnaplEventWamEvent").PsChannelsSnaplEventWamEvent)({appId:167028690535322,videoEventJson:JSON.stringify({events:a.events,required_metadata:a.required_metadata})}).commit()});break;case d("WAWebVideoOrigin").VideoOrigin.Status:a.forEach(function(a){d("WAWebMediaPlaybackEventLogger").MediaPlaybackEventLogger.log(a)});break}};b.discardLogsWithoutFlushing=function(){var a=this.$1.consumeLoggerEvents();a.forEach(function(a){d("WALogger").DEV(h(),a.required_metadata.media_id).devConsole(a)})};return a}();g.WhatsAppMediaPlaybackLogFlusher=a}),98);
__d("WAWebCometVideoPlayerStateMachine",["MediaPlaybackCompoundEventStateMachineLogger","VideoPlayerImplementationEngineVideoElementAPI","VideoPlayerImplementationStateMachine","VideoPlayerImplementationStateMachineState","VideoPlayerImplementationStateMachineStateUncontrolledState","WALogger","WAWebMediaPlaybackLogFlusher","WAWebNoop"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mediaplayback][snapl] Fatal error in SNAPL machine"]);h=function(){return a};return a}function a(a){var b=a.initialLoggingMetaData,e=a.debugLogId,f=a.fullscreenControllerRef,g=a.videoEl,j=a.videoLiveTraceRef,k=a.videoPlayerPassiveViewabilityInfoRef,l=a.metadataProvider;a=a.videoOrigin;var m=d("MediaPlaybackCompoundEventStateMachineLogger").createMediaPlaybackCompoundEventStateMachineLogger({debugLogId:e,initialLoggingMetaData:b,metadataProvider:l}),n=new(d("WAWebMediaPlaybackLogFlusher").WhatsAppMediaPlaybackLogFlusher)(m,a);l=[function(a,b,c){m.handleStateMachine(a,b,c);n.flushLogs();return!0}];a=d("VideoPlayerImplementationStateMachineState").createVideoPlayerImplementationStateMachineInitialState({alwaysShowCaptions:!1,captionDisplayStyle:null,dimensions:b.dimensions,areCaptionsAutogenerated:!1,isAbrEnabled:!1,playerVersion:"comet_whatsapp_snapl_only",streamingFormat:"progressive"});var o=d("VideoPlayerImplementationStateMachine").createVideoPlayerImplementationStateMachineWithStateTransitionHandlers({collectUncontrolledState:i(g,j,f,k),stateTransitionHandlers:l,debugLogId:e,initialState:a,onFatalError:function(a){a=a instanceof Error?a.message:String(a);d("WALogger").ERROR(h()).sendLogs("snapl-fatal-error").devConsole(a)}});return{machine:o,callbacks:d("VideoPlayerImplementationStateMachine").createReactVideoElementCallbacksForStateMachine(o,c("WAWebNoop")),handleReactEffectInit:function(){var a=o.getCurrentState().controlledState.mountState;a==="before_mounted"&&o.dispatch({type:"implementation_mounted"})},handleReactEffectCleanup:function(){o.dispatch({payload:{reason:"react_effect_cleanup"},type:"implementation_unmounted"})}}}function i(a,b,c,e){return function(){return d("VideoPlayerImplementationStateMachineStateUncontrolledState").createVideoPlayerImplementationStateMachineStateUncontrolledState({engineExtrasAPI:null,fullscreenControllerRef:c,videoElementAPI:d("VideoPlayerImplementationEngineVideoElementAPI").createVideoPlayerImplementationEngineVideoElementAPI(a),videoLiveTraceRef:b,videoPlayerPassiveViewabilityInfoRef:e})}}g.makeCometVideoPlayerStateMachine=a}),98);
__d("WAWebMusicGatingUtils",["WAWebABProps"],(function(a,b,c,d,e,f,g){"use strict";function a(){return d("WAWebABProps").getABPropConfigValue("wabba_receiver_enabled")}function b(){return d("WAWebABProps").getABPropConfigValue("wabba_save_to_camera_roll_enabled")}g.isStatusMusicReceiverEnabled=a;g.isStatusMusicSaveToDiskEnabled=b}),98);
__d("WAWebMusicPlaybackUtils",["WAWebCountriesUtils","WAWebL10NCountryCodes","WAWebUserPrefsMeUser"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=h();return c!=null&&b.has(c)&&!a.has(c)}function h(){var a=d("WAWebUserPrefsMeUser").getMaybeMeUser();return a==null?null:d("WAWebCountriesUtils").asISOCountryCode(d("WAWebL10NCountryCodes").getCountryShortcodeByPhone(a.user))}function b(){var a=h();if(a==null)return null;switch(a){case"AC":return"SH";default:a;return a}}g.canPlaybackMusic=a;g.getUserCountryCode=h;g.getUserCountryCodeForSNAPL=b}),98);
__d("useWAWebCometVideoPlayerStateMachine",["WAWebCometVideoPlayerStateMachine","WAWebMusicGatingUtils","WAWebMusicPlaybackUtils","WAWebNewsletterGatingUtils","WAWebNoop","WAWebSNAPLUserPrefs","WAWebVideoOrigin","WAWebWamMediaMetricUtils","react","useWAWebUnmountSignal","videoPlayerUniqueID"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.useCallback,j=b.useEffect,k=b.useRef,l=b.useState,m={current:null},n={current:null},o={current:null},p=function(){return{}},q={StatusViewer:"status_viewer",NewsletterViewer:"whatsapp_channels"},r=function(a){switch(a){case d("WAWebVideoOrigin").VideoOrigin.Status:return!d("WAWebMusicGatingUtils").isStatusMusicReceiverEnabled();case d("WAWebVideoOrigin").VideoOrigin.Newsletter:return!d("WAWebNewsletterGatingUtils").isNewsletterVideoPlaybackLoggingEnabled()}},s=function(a){switch(a){case d("WAWebVideoOrigin").VideoOrigin.Status:return q.StatusViewer;case d("WAWebVideoOrigin").VideoOrigin.Newsletter:return q.NewsletterViewer}};function a(a){var b=a.mediaId,e=a.isCopyrightMuted,f=a.videoOrigin,g=a.mediaIdString,h=c("useWAWebUnmountSignal")(),q=k(null),t=k(e),u=k(null),v=function(){return r(f)};a=l(function(){return v()});var w=a[0],x=a[1];a=l({handleReactEffectInit:c("WAWebNoop"),handleReactEffectCleanup:c("WAWebNoop"),callbacks:null});var y=a[0],z=a[1];a=i(function(a){var e=q.current;if(e===a)return;q.current=a;var i=q.current;if(i==null||b==null||!d("WAWebMusicGatingUtils").isStatusMusicReceiverEnabled()){z({handleReactEffectInit:c("WAWebNoop"),handleReactEffectCleanup:c("WAWebNoop"),callbacks:null});(b==null||!d("WAWebMusicGatingUtils").isStatusMusicReceiverEnabled())&&x(!0);return}var j=d("WAWebSNAPLUserPrefs").getSNAPLPersistentId(b,f);e={height:i.clientHeight,width:i.clientWidth};a={accessToken:null,dimensions:e,productAttribution:null,downstreamShareSignalTracking:null,trackingNodes:"",trackingDataEncrypted:"",playerImplementationInstanceCountRef:{current:1},coreVideoPlayerMetaData:{loggingConfig:{loggingToSNAPLCreateMetadataProvider:null}},instanceKey:c("videoPlayerUniqueID")()};u.current=a;e=d("WAWebCometVideoPlayerStateMachine").makeCometVideoPlayerStateMachine({initialLoggingMetaData:a,debugLogId:d("WAWebWamMediaMetricUtils").generateMediaEventId().toString(10),videoEl:i,fullscreenControllerRef:m,videoLiveTraceRef:n,videoPlayerPassiveViewabilityInfoRef:o,metadataProvider:{getErrorMetadata:p,getRequiredMetadata:function(){var a;return{current_watching_module:s(f),media_id:b,tracking_type:"organic",persistent_id:j,media_id_string:(a=g)!=null?a:""}},getTagMetadata:function(){return{is_copyright_muted:t.current,country:d("WAWebMusicPlaybackUtils").getUserCountryCodeForSNAPL(),player_sound_on:!i.muted}}},videoOrigin:f});a=e.callbacks;var k=e.handleReactEffectInit,l=e.handleReactEffectCleanup;e=e.machine;if(h.aborted===!0)return;z({machine:e,handleReactEffectInit:k,handleReactEffectCleanup:l,callbacks:a});x(!0)},[b,h.aborted,f,g]);j(function(){t.current=e;var a=y.machine,b=u.current;if(a==null||b==null)return;a.dispatch({payload:{loggingMetaData:b},type:"notify_logging_metadata_change"})},[y.machine,e]);return{callbacks:y.callbacks,handleReactEffectInit:y.handleReactEffectInit,handleReactEffectCleanup:y.handleReactEffectCleanup,ready:w,videoElementRefCallback:a}}g["default"]=a}),98);